
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <title>Ejercicio Listado Personas. AJAX</title>
    <style type="text/css">

    </style>
    <script src="./ajaxUtils.js" defer></script>
    <script type="text/javascript">
		
      window.onload = () => {
        pedirPersonas();
        document.querySelector('#btAnade').onclick = ()=>{
          aniadePersona();
        }
        document.querySelector('#btBorrar').onclick = ()=>{
          borraPersona();
        }
      }
      function borraPersona(){
        let id = document.querySelector('#id').value;
        let jsonObject = JSON.stringify({servicio: "borrar",ID:id})
        resolveAjax("POST","http://localhost/ajax/tablas/servidor.php",jsonObject,()=>{
        });
        pedirPersonas();
      };
			function aniadePersona(){
          let dni = document.querySelector('#dni').value;
          let nombre = document.querySelector('#nombre').value;
          let apellidos = document.querySelector('#apellidos').value;
          let jsonObject = JSON.stringify({servicio:"insertar",DNI:dni,NOMBRE:nombre,APELLIDOS:apellidos})
          resolveAjax("POST","http://localhost/ajax/tablas/servidor.php",jsonObject,(datos)=>{
          })
          pedirPersonas();
      }
			function pedirPersonas(){
        resolveAjax("POST","http://localhost/ajax/tablas/servidor.php", JSON.stringify({servicio:"listar"}),(datos)=>{
          console.table(datos);
          pintarPersonas(datos)
        });
      };
      function pintarPersonas(datos){
        let cuerpo = document.querySelector('#filas_tabla');
        for(persona of datos){
          let fila = document.createElement('tr');
          for(i in persona){
            let columna = document.createElement('td');
            columna.innerHTML = persona[i];
            fila.append(columna);
            cuerpo.append(fila);
          }
        }
      }
    </script>
  </head>
  <body>
    <h1>Registro de Usuarios</h1>

    <form>
      <label for="dni">DNI:</label>
      <input type="text" id="dni" name="dni" value="27473339T" />
      <span id="infoDNI"> </span>
      <br/>
      <label for="nombre">NOMBRE:</label>
      <input type="text" id="nombre" name="nombre" value="Marco Elio" />
      <br/>
      <label for="apellidos">APELLIDOS:</label>
      <input type="text" id="apellidos" name="apellidos" value="García Gomariz" />
      <br/>

      <br/>
     
      <table id="tabla_personas" border="1">
        <tr>
          <th>ID</th>
          <th>DNI</th>
          <th>NOMBRE</th>
          <th>APELLIDOS</th>
        </tr>
        
        <tbody id="filas_tabla">
        
        </tbody>
      </table>

      <br/>
      <br/>
      <input type="button" value="AÑADIR" id="btAnade" />
			<br><br>
			<input type="button" value="BORRAR" id="btBorrar" />
			<input type="text" id="id" name="id" value="" size="5" placeholder="ID a borrar" />
    </form>

  </body>
</html>
