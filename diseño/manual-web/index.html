<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <title>Manual Web</title>
    <style>
    </style>
  </head>
  <body>
    <div class="container">
      <div class="navegacion">
        <nav>
            <label for="inicio">Inicio</label>
            <label for="docker">Docker</label>
            <label for="apache">Apache</label>
            <label for="nginx">Nginx</label>
            <label for="caddy">Caddy</label>
        </nav>
      </div>
      <div class="content-body">
        <input type="radio" name="rad" checked id="inicio">
        <div class="content inicio">
        <section>
          <img class="imgs-animations" style="position: absolute; top: 10%;" src="./images/docker-logo.png" alt="">
          <img class="imgs-animations" style="animation-delay:.3s;position: absolute; top: 50%; width: 10%; height: 15%;" src="./images/caddy.png" alt="">
          <img class="imgs-animations" style="animation-delay:.5s;position: absolute; top: 60%;left: 60%; width: 10%; height: 20%;" src="./images/nginx.png" alt="">
          <img class="imgs-animations" style="animation-delay:.7s;position: absolute; top: 10%;left: 80%; width: 10%; height: 20%;" src="./images/apache.png" alt="">
          <h2 style="border:transparent;background:transparent;">Despliegue de Servidores Web Apache, Nginx y Caddy</h2>
        </section>
      </div>
      <input type="radio" name="rad" id="docker">
      <div class="content docker">
        <div class="menu">
          <h3>Navegación rápida</h3>
          <ul>
            <li><a href="#qEs">¿Que es?</a></li>
            <li><a href="#cFunciona">¿Como funciona?</a></li>
            <li><a href="#instalacion">Instalación</a></li>
          </ul>
        </div>
        <section>
          <h2 class="titleSection" id="qEs">¿Que es Docker?</h2>
          <p style="margin-bottom: 40px;">
            Docker es uno de los proyectos más conocidos y utilizados en temas de virtualización.
             Lejos de ser un sistema operativo como tal, esta plataforma de código abierto hace uso de las funciones de aislamiento de recursos del kernel 
             de Linux para poder dar lugar a contenedores independientes, dentro de los cuales se ejecutará una única aplicación con sus respectivas dependencias, 
             pero funcionando siempre con un único kernel, el de la máquina real, en lugar de virtualizar uno por cada contenedor o máquina virtual.
            <img src="./images/docker-logo.png">
            <br><br>
            ¿Y que es un contenedor? Esto es un concepto antiguo de Linux y este nombre es debido a como docker funciona, y utiliza
            el kernel de Linux para poder aislar las aplicaciones para que se ejecuten de manera independiente. Un contenedor de Docker
            contiene los archivos necesarios e imprescindibles para que esa aplicacion funcione correctamente, por eso son ligeros y portables.

          </p>
          
          <h2 class="titleSection" id="cFunciona">¿Como funciona?</h2>
          <p>Docker usa el kernel de Linux y algunas funciones de este, como los Cgroups y los namespaces, para segregar los procesos,
            de modo que puedan ejecutarse de manera independiente. El propósito de los contenedores es esta independencia:
            la capacidad de ejecutar varios procesos y aplicaciones por separado para hacer un mejor uso de su infraestructura y, al
            mismo tiempo, conservar la seguridad que tendría con sistemas separados.
            <img class="img-resize" src="./images/docker-vms.jpg" style="width: 40%; height: 25%;margin-top: 10px;" alt="">
            <br><br>
            Docker ofrece un modelo de implementación basado en imágenes. Esto permite compartir una aplicación, o un conjunto de servicios,
            con todas sus dependencias en varios entornos. Docker también automatiza la implementación de la aplicación en este entorno de contenedores
          </p>
          <h3>¿Diferencias con respecto a una maquina virtual?</h3>
          <p>
            La principal diferencia con respecto a las maquinas virtuales es que Docker realiza una virtualización a nivel
            de sistema operativo, no virtualiza un sistema operativo por completo. Mientras que en las maquinas virtuales necesitas contar 
            con un sistema operativo completo virtualizado(ocupando por ejemplo 1gb de memoria RAM), Docker aprovecha el kernel de la maquina
            anfitriona y, con su motor, tan solo carga en la memoria las librerias y dependencias necesarias para ejecutar esa aplicacion, ocupando así
            mucho menos espacio, alrededor de un 80% menos.
            <br><br>
            Las principales ventajas de Docker son las siguientes:
            <ul>
              <li><strong>Portabilidad: </strong> todos los contenedores de docker son portables, por lo que podemos llevarlos facilmente a cualquier otro equipo
              con Docker sin tener que volver a configurar nada</li>
              <li><strong>Ligereza: </strong>al no virtualizar un sistema operativo completo, sino solo lo necesario, el consumo de recursos es mínimo.</li>
              <li><strong>Autosuficiencia: </strong> docker practicamente se encarga de todo, gracias al Docker Engine, servicio el cual se encarga de dar a los 
              contenedores los recursos necesarios para que estos funcionen, es decir, si contenedor recibe una carga de trabajo mayor, Docker automaticamente le asigna
            mas recursos físicos para que este pueda seguir operando, por lo que los contenedores tan solo deben tener lo necesario para que la aplicación funcione,
          como librerías y configuraciones para poder desempeñar su función.</li>
            </ul>
          </p>
          <h2 class="titleSection" id="instalacion">Instalación</h2>
          <details>
            <summary>Windows</summary>
            <p>
              Para la instalación de docker en Windows es necesario habilitar el <strong>subsistema de windows para linux</strong>, existen dos maneras de hacerlo, la primera: 
              es irse al apartado de Activar y Desactivar características de Windows, al cual se puede acceder mediante la busqueda en la parte inferior izquierda o pulsando las teclas 
              <kbd>CRTL</kbd> + <kbd>R</kbd> y escribiendo <strong><i>control panel</i></strong> y dentro del <strong>Panel de control > Programas y características > Activar o Desactivar
                características de Windows</strong> una vez dentro de activar o desactivar características de windows se busca <strong>Subsistema de Windows para Linux</strong>.
                
            </p>

            <img src="./images/caracteristicas.PNG" style="float: none; text-align: center;" alt="">
            <br><br>
            Despues de instalar el Subsistema de Windows para Linux, hay que descargarse <a href="https://www.docker.com/products/docker-desktop" style="color: white;">Docker Desktop</a> que es 
            una herramienta visual para el manejo de contenedores, una vez instalado eso se podrá  hacer uso de todos los comandos de Docker.
          </details>
          <details>
            <summary>Linux(Ubuntu)</summary>
            Para instalar Docker en Ubuntu hay que irse al terminal y ejecutar los siguientes comandos:
            <pre style="background: #33373A; border-radius: 5px;border: 1px solid black; padding: 5px;">
<span class="dolar">$</span> <span class="sudo">sudo</span> apt-get update

<span class="dolar">$</span> <span class="sudo">sudo</span> apt-get install  <span class="barra">\</span>
    apt-transport-https <span class="barra">\</span>
    ca-certificates  <span class="barra">\</span>
    curl  <span class="barra">\</span>
    gnupg-agent  <span class="barra">\</span>
    software-properties-common
    <span class="dolar">$</span> curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="sudo">sudo</span> apt-key add -

<span class="dolar">$</span> <span class="sudo">sudo</span> apt-key fingerprint 0EBFCD88

<span class="dolar">$</span> <span class="sudo">sudo</span> add-apt-repository <span class="barra">\</span>
  "deb [arch=amd64] https://download.docker.com/linux/ubuntu <span class="barra">\</span>
  $(lsb_release -cs) <span class="barra">\</span>
  stable"

<span class="dolar">$</span> <span class="sudo">sudo</span> apt-get update

<span class="dolar">$</span> <span class="sudo">sudo</span> apt-get install docker-ce docker-ce-cli containerd.io
            </pre>
            <iframe src="http://showterm.io/5a71e622c7d2324d01f4b#stop" width="650px" height="400px" frameborder="0"></iframe>
          </details>

        </section>
      </div>
      <input type="radio" name="rad" id="apache">
      <div class="content">
        <section>
          <h2 class="titleSection">Despliegue de Apache con Docker</h2>
          <p style="margin-bottom: 120px;">
            <img src="./images/apache.png" style="width: 150px;height: 150px;" alt="">
            El despliegue de un contenedor apache con Docker capaz de interpretar PHP se puede realizar con un solo comando, lo único necesario es crear un archivo php que pueda interpretar, 
            así que lo primero que hay que hacer es crear el fichero PHP y ubicarlo dentro de una carpeta:
            
            <pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px;">
<span class="dolar">$</span> <span class="sudo">sudo</span> mkdir apache-php && <span class="sudo">sudo</span> vi index.php</pre>
            Una vez creada la carpeta con el fichero PHP dentro de la carpeta, hay que descargarse la imagen que contiene PHP y Apache con el siguiente comando:
<pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px;">
<span class="dolar">$</span> <span class="sudo">sudo</span> docker pull php:7.2-apache</pre>
            Descargada la imagen, para lanzar el contenedor con Apache se hace con el siguiente comando:
<pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px;">
<span class="dolar">$</span> <span class="sudo">sudo</span> docker run -d -p 80:80 -v ${pwd}/{nombreCarpetaphp}/:/var/www/html --name web-apache php:7.2-apache</pre>
          </p>
          <p>El comando docker run mas sus argumentos hacen los siguientes: </p>
          <ul class="lista">
            <li style="list-style: disc;"><span style="background-color: #242424;padding: 2px 4px 2px 4px;border-radius: 5px;">Docker Run</span>: es el comando utilizado para el despliegue de contenedores a partir de una imagen.</li>
            <li style="list-style: disc;"><span style="background-color: #242424;padding: 2px 4px 2px 4px;border-radius: 5px;">-d</span>: es una manera de lanzar el contenedor, en este caso es detached en segundo plano.</li>
            <li style="list-style: disc;"><span style="background-color: #242424;padding: 2px 4px 2px 4px;border-radius: 5px;">-p</span>: es la manera de decirle a Docker los puertos a asignar, los puertos delante de los dos puntos 
              pertenecen a la maquina anfitriona, y los que están despues a los del contenedor, es decir, si queremos desplegar el mismo servidor apache varias veces solo tendríamos que cambiar el 80 que está justo delante de los dos puntos.</li>
            <li style="list-style: disc;"><span style="background-color: #242424;padding: 2px 4px 2px 4px;border-radius: 5px;">-v</span>: esto corresponde a los volumenes de docker, los cuales son como carpetas o espacios compartidos 
                entre la maquina anfitriona y el contenedor, y al igual que con los puertos la ruta que está justo delante de los dos puntos pertenece a la maquina anfitriona y la que está detrás al contenedor.</li>
            <li style="list-style: disc;"><span style="background-color: #242424;padding: 2px 4px 2px 4px;border-radius: 5px;">--name</span>: esto se utiliza para asinarle un nombre al contenedor que se lanza, ya que por defecto Docker 
                le asigna a todos los contenedores un ID único y tú le puedes asignar un nombre para ejecutar comandos sobre él(este nombre será unico para el contenedor no se puede repetir).</li>
            <li style="list-style: disc;"><span style="background-color: #242424;padding: 2px 4px 2px 4px;border-radius: 5px;">php:7.2-apache</span>: es el nombre de la imagen que se va utilizar para desplegar el contenedor.</li>      
          </ul>
          <div style="background: #24282A; border: 2px solid black; padding: 7px; border-radius: 5px;">
            <h4 style="margin:0;">Consejo/Nota</h4>
            <p>Con Docker es recomendable trabajar con rutas absolutas, y no es lo mismo poner: <strong>/directorio/directorio1</strong> que <strong>/directorio/directorio1/</strong>, con 
              <strong>/directorio/directorio1</strong> estamos diciendo a Docker que copia el directorio completo junto a sus contenidos y con <strong>/directorio/directorio1/</strong> le estamos diciendo
            a Docker que copie los contenidos de ese directorio.</p>
          </div>
          <h3 style="margin-bottom: 10px; margin-top: 10px;">Video de configuración de Apache con Docker</h3>
          <iframe style="margin-top: 10px;" src="http://showterm.io/6112333f78240c61db3ee#stop" width="700px" height="400px" frameborder="0"></iframe>
          <br>
          <p>El resultado de esta serie de pasos es el siguiente: </p>
          <img src="./images/apache-final.PNG" style="width: 60%; height: 30%; margin-bottom: 10px;float:none;" alt="">
        </section>
      </div>
      <input type="radio" name="rad" id="nginx">
      <div class="content">
        <section>
        <h2 class="titleSection">Despliege de Nginx con Docker</h2>
        <p>
          <img src="./images/nginx.png" style="width: 100px;height: 100px;" alt="">
          Para configurar nginx con docker esta vez es necesario tener levantado un contenedor aparte con PHP FastCGI,
           que es un protocolo que se utiliza para interconectar programas interactivos con servidores web y un segundo contenedor
           con Nginx:
        </p>
        <p style="margin-bottom: 30px;">Para desplegar el contenedor php-fpm es necesario primero hacer un pull de la imagen: </p>
        <div style="min-width: 0;">
<pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px; max-width: 100%;">
  <span class="dolar">$</span> <span class="sudo">sudo</span> docker pull php:7.2-fpm-alpine</pre>
</div>
        <p>Una vez hecho el pull de la imagen es necesario crear el archivo/s que queremos mostrar en una carpeta para compartirla con el contenedor, y ejecutar el comando docker run: </p>
<pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px;">
  <span class="dolar">$</span> <span class="sudo">sudo</span> docker run --name php-fpm -v $PWD/{carpetaContenedoraPHP}/:/var/www/html php:7.2-fpm-alpine</pre>
        <p>Una vez levantado el contenedor con PHP con FastCGI hay que preparar la configuración para el contenedor de nginx y have un pull de su imagen, la configuración de host necesaria es la siguiente: </p>
        <pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px;">
server {
  index index.php index.html;
  server_name localhost;
  
  root /var/www/html;

  location ~ \.php$ {
    try_files $uri =404;
    fastcgi_split_path_info ^(.+\.php)(/.+)$;

    fastcgi_pass php-fpm:9000;

    fastcgi_index index.php;
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param PATH_INFO $fastcgi_path_info;
  }
}     
        </pre>
        <p>Comando necesario para hacer pull de la imagen de nginx: </p>
        <p style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px;">
  <span class="dolar">$</span> <span class="sudo">sudo</span> docker pull nginx</p>
        <p>Y los mismo archivos que se usaron con el contenedor php-fpm y se levanta el contenedor con el siguiente comando: </p>
        <div style="min-width: 0;">
        <pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px;white-space: pre-wrap;">
  <span class="dolar">$</span> <span class="sudo">sudo</span> docker run -d --name nginx -p 8080:80 -v $PWD/{carpetaConLaConfig}:/etc/nginx/conf.d -v $PWD/{carpetaContenedoraDeArchivosPHP}:/var/www/html --link php-fpm php:7.2-fpm-alpine</pre>
        </pre>
      </div>

        <p>El argumento --link sirve para conectar un contenedor con otro, esto es muy útil cuando un contenedor depende de otro, por ejemplo en la configuración de nginx, en el apartado 
          <strong>fastcgi_pass php-fpm:9000</strong> <strong>php-fpm</strong> es el nombre del contenedor de PHP FPM y 9000 es el puerto por defecto que se le asigna, esto se le puede aplicar, por ejemplo, 
        a una base de datos MySQL.</p>
        <h3>Video de configuración de contenedor nginx</h3>
        <iframe style="margin-top: 10px;" src="http://showterm.io/8827e17b356c67525342c#stop" width="750px" height="400px" frameborder="0"></iframe>
        </section>
      </div>
      <input type="radio" name="rad" id="caddy">
      <div class="content">
        <section>
          <h2 class="titleSection">Despliegue de Caddy con Docker</h2>
          <h3>¿Que es Caddy?</h3>
          <p>
          <img src="./images/caddy.png" width="10%" height="10%" alt="">
          Caddy o la nueva versión de Caddy, Caddy 2 es un servidor web potente, open source, con HTTPS automático y escrito en Go. Caddy se encarga de renovar 
          los certificado TLS, servicio de archivos estáticos, reverse proxy, ingreso en Kubernetes, y más. Al estar escrito en Go, se complementa perfectamente 
          con Docker.
          </p>
          <p style="margin-bottom: 30px;">Para desplegar Caddy con Docker, es necesario tener levantado el contenedor de PHP-FPM como con el servidor nginx, para hacer esto, lo primero es hacer un pull, 
            de la imagen de <strong>php:7.2-alpine</strong> de la siguiente manera: 
          </p>
          <pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px; max-width: 100%;">
  <span class="dolar">$</span> <span class="sudo">sudo</span> docker pull php:7.2-fpm-alpine</pre>
          <p>Una vez hecho el pull de la imagen, hay que desplegar el contenedor con el comando <strong>docker run</strong>: </p>
          <pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px;">
  <span class="dolar">$</span> <span class="sudo">sudo</span> docker run --name php-fpm -v $PWD/{carpetaContenedoraPHP}/:/var/www/html php:7.2-fpm-alpine</pre>
          <p>Desplegado el contenedor PHP-FPM, hay que hacer un pull de la imagen de Caddy: </p>
          <pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px;">
  <span class="dolar">$</span> <span class="sudo">sudo</span> docker pull caddy</pre>
          <p>Hecho el pull de la imagen de Caddy, hay que crear un archivo de configuración para caddy llamado Caddyfile, y su contenido puede ser el siguiente: </p>
          <pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px;">
  :80
  root * /var/www/html
  php_fastcgi php-fpm:9000</pre>
          <p>Terminado el archivo de configuración tan solo hace falta tener los mismo archivos php que se usaron con el contenedor PHP-FPM y desplegar el contenedor con Caddy: </p>
    <pre style="background: #24282A; border-radius: 5px;border: 1px solid black; padding: 5px; max-width: 100%;">
  <span class="dolar">$</span> <span class="sudo">sudo</span> docker run -d -p 80:80 -v $PWD/{carpetaFicheroCaddyfile}/:/etc/caddy -v $PWD/caddy/{carpetaFicherosPHP}/:/var/www/html --name caddy --link php-fpm caddy</pre>
        <iframe style="margin: 10px 0 10px 0;" src="http://showterm.io/0f8917de6fd507ae74268#stop" width="700px" height="400px" frameborder="0"></iframe>
        <h2 class="titleSection">Comparativa con Nginx y Apache</h2>
        <p>Caddy es menos conocido que Nginx o Apache, pero tiene una serie de herramientas muy útiles como el HTTPS automático, además si se despliega en Docker, al estar escrito en Go estos se complementan perfectamente
        y pueden dar un rendimiento realmente bueno, aparte de tener un consumo de recursos muy bajo, como por ejemplo en el caso de las imagenes: </p>
        <table style="margin: auto;">
          <thead>
            <tr>
              <th colspan="3">Tamaño de las imagenes</th>
            </tr>
            <tr>
              <th>Apache</th>
              <th>Nginx</th>
              <th>Caddy</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>410MB</td>
              <td>207MB</td>
              <td>113MB</td>
            </tr>
          </tbody>
        </table>
        <p>Como se puede ver el tamaño de la imagen de caddy es mucho menor que la de apache y un poco menor que la de Nginx, con respecto a Apache se está ahorrando un 72,5% del almacenamiento y con respecto a 
          Nginx un 45,5%
        </p>
        </section>
      </div>
      </div>
    </div>
  </body>
</html>
